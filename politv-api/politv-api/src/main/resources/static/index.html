<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chat PoliTV</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
</head>
<body>
  <h2>Chat en vivo - Programa 1</h2>

  <div id="chat-box" style="border:1px solid #ccc; width:400px; height:250px; overflow-y:scroll; padding:10px;"></div>

  <input id="usuarioId" type="number" placeholder="ID Usuario">
  <input id="mensaje" type="text" placeholder="EscribÃ­ tu mensaje...">
  <button onclick="sendMessage()">Enviar</button>

  <script>
    let stompClient = null;
    const programaId = 1;

    function connect() {
      const socket = new SockJS("/chat-websocket");
      stompClient = Stomp.over(socket);
      stompClient.connect({}, () => {
        stompClient.subscribe(`/topic/chat/${programaId}`, (msg) => {
          const data = JSON.parse(msg.body);
          showMessage(`${data.nombreUsuario}: ${data.mensaje}`);
        });
      });
    }

    function showMessage(message) {
      const chatBox = document.getElementById("chat-box");
      const p = document.createElement("p");
      p.textContent = message;
      chatBox.appendChild(p);
    }

    function sendMessage() {
      const usuarioId = document.getElementById("usuarioId").value;
      const mensaje = document.getElementById("mensaje").value;

      stompClient.send(`/app/chat/${programaId}`, {}, JSON.stringify({
        usuarioId: parseInt(usuarioId),
        programaId: programaId,
        mensaje: mensaje
      }));

      document.getElementById("mensaje").value = "";
    }

    connect();
  </script>
</body>
</html>
